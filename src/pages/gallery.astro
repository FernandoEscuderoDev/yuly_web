---
import CardPost from "../components/CardPost.astro";
import Layout from "../layouts/Layout.astro";
import "photoswipe/style.css";
import "photoswipe-dynamic-caption-plugin/photoswipe-dynamic-caption-plugin.css";
---

<Layout>
  <main class="p-4">
    <ul
      class="mx-auto gap-4 columns-2 md:columns-3 lg:columns-4 xl:columns-5 2xl:columns-6"
      id="my-gallery"
    >
      <CardPost />
    </ul>
  </main>
</Layout>
<script>
  import PhotoSwipeLightbox from "photoswipe/lightbox";
  import PhotoSwipeDynamicCaption from "photoswipe-dynamic-caption-plugin";

  let lightbox;

  // FunciÃ³n para inicializar el Lightbox
  const initLightbox = () => {
    // Si ya existe una instancia previa, destruirla antes de crear una nueva
    if (lightbox) {
      lightbox.destroy();
    }

    lightbox = new PhotoSwipeLightbox({
      gallery: "#my-gallery",
      childSelector: ".pswp-gallery__item",
      showHideAnimationType: "fade",
      closeOnVerticalDrag: true,
      bgOpacity: 0.9,
      wheelToZoom: true,
      pswpModule: () => import("photoswipe"),
    });

    const captionPlugin = new PhotoSwipeDynamicCaption(lightbox, {
      type: "auto",
      captionContent: '.pswp-caption-content',
      mobileLayoutBreakpoint: 600,
      horizontalEdgeThreshold: 20,
      mobileCaptionOverlapRatio: 0.3,
    });

    lightbox.init();
  };

  // Escuchar el evento `astro:after-swap` para reinicializar el Lightbox
  document.addEventListener("astro:after-swap", () => {
    initLightbox();
  });

  // Inicializar el Lightbox en la primera carga
  document.addEventListener("DOMContentLoaded", () => {
    initLightbox();
  });
</script>
