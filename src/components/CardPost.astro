---
export const prerender = false;
import { urlForImage } from "../sanity/lib/urlForImage";
import { loadQuery } from "./../sanity/lib/load-query";
import PortableTextImage from "./PortableTextImage.astro";

const { data: posts } = await loadQuery({
  query: `*[_type == "cardGallery" && defined(slug.current)]{title, "mainImage": mainImage.asset->url,
  "imageWidth": mainImage.asset->metadata.dimensions.width,
  "imageHeight": mainImage.asset->metadata.dimensions.height, 'alt' : mainImage.alt,'caption': caption} | order(publishedAt asc)`,
  params: {},
});
---

{
  posts.map((post) => (
    <li class="md:hover:underline pswp-gallery__item relative max-w-full mb-4 group md:hover:z-30 rounded-lg break-inside-avoid">
      <a
        href={urlForImage(post.mainImage)
          .width(1920)
          .height(Math.round((1920 * post.imageHeight) / post.imageWidth))
          .format("webp")
          .quality(80)
          .url()}
        data-pswp-width={1920}
        data-pswp-height={Math.round(
          (1920 * post.imageHeight) / post.imageWidth
        )}
        data-pswp-caption={post.alt || "Imagen sin texto Alternativo"}
      >
        <PortableTextImage
          classImg="max-w-full object-center rounded-lg transform md:group-hover:scale-105 md:group-hover:shadow-[rgba(0,_0,_0,_0.10)_0px_0px_60px_-10px] md:group-hover:shadow-fuchsia-500 transition-all duration-300 ease-in-out"
          asset={post.mainImage}
          alt={post.alt || "Imagen sin texto Alternativo"}
          imageHeight={post.imageHeight}
          imageWidth={post.imageWidth}
        />
      </a>
      <div class="pswp-caption-content text-balance">
        <h2 class="text-xl font-bold">{post.title}</h2>
        <p>{post.caption || "Imagen sin texto Alternativo"}</p>
      </div>
    </li>
  ))
}
